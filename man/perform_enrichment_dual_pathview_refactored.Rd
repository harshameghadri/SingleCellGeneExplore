% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/perform_enrichment_dual_pathview.R
\name{perform_enrichment_dual_pathview_refactored}
\alias{perform_enrichment_dual_pathview_refactored}
\title{Perform Comprehensive Enrichment Analysis and Pathway Visualization}
\usage{
perform_enrichment_dual_pathview_refactored(
  de_results_list,
  top_n = 20,
  pval_cutoff = 0.05,
  up_log2fc_threshold = 0.25,
  down_log2fc_threshold = -0.25,
  max_genes_for_enrichment = NULL,
  enrichr_dbs = c("GO_Biological_Process_2023", "GO_Cellular_Component_2023",
    "GO_Molecular_Function_2023", "WikiPathways_2024_Human", "Reactome_Pathways_2024",
    "KEGG_2021_Human", "ChEA_2022", "ENCODE_and_ChEA_Consensus_TFs_from_ChIP-X",
    "TRANSFAC_and_JASPAR_PWMs", "MSigDB_Hallmark_2020"),
  outdir = "enrichment_results",
  kegg_n = 10,
  use_full_fc_for_pathview = TRUE,
  pathview_colors = c("blue", "gray", "red"),
  save_all_results = TRUE,
  plot_width = 8,
  plot_height = 6,
  plot_units = "in",
  plot_dpi = 300,
  plot_formats = c("png"),
  pdf_width = 11,
  pdf_height = 8.5,
  cnet_color_edge = TRUE,
  parallel.per.celltype = FALSE,
  n_cores = NULL
)
}
\arguments{
\item{de_results_list}{A named list of data frames. Each data frame should
contain differential expression results for a specific cell type and must
include columns: "gene" (gene symbol), "p_val_adj" (adjusted p-value),
and "avg_log2FC" (average log2 fold change).}

\item{top_n}{An integer specifying the maximum number of enriched terms or
pathways to display in plots (e.g., barplots, cnetplots). Default: 20.}

\item{pval_cutoff}{A numeric value for the adjusted p-value cutoff to
determine statistical significance for enrichment results display and gene selection.
Default: 0.05.}

\item{up_log2fc_threshold}{A numeric value for the minimum positive log2 fold
change to consider a gene as up-regulated. Default: 0.25.}

\item{down_log2fc_threshold}{A numeric value for the maximum negative log2 fold
change to consider a gene as down-regulated. Default: -0.25.}

\item{max_genes_for_enrichment}{An optional numeric value. If provided and positive,
it caps the number of most significant up-regulated genes and, separately,
down-regulated genes (sorted by p-value then absolute fold change) submitted
for enrichment. If NULL, Inf, or non-positive, all genes passing
\code{pval_cutoff} and log2FC thresholds are used. Default: NULL.}

\item{enrichr_dbs}{A character vector of Enrichr database names to query.
Default: c("GO_Biological_Process_2023", "GO_Cellular_Component_2023", ...).}

\item{outdir}{A string specifying the main output directory path where all
results will be saved. Default: "enrichment_results".}

\item{kegg_n}{An integer specifying the maximum number of top KEGG pathways
(ordered by p-value) to visualize using Pathview. Default: 10.}

\item{use_full_fc_for_pathview}{A logical value. If TRUE, Pathview visualizations
will use fold change data from all significant genes in the input DE table for
coloring, rather than just the subset currently being analyzed (e.g., up-regulated only).
Default: TRUE.}

\item{pathview_colors}{A character vector of three colors for Pathview:
low expression, mid-expression (neutral), and high expression.
Default: c("blue", "gray", "red").}

\item{save_all_results}{A logical value. If TRUE, all enrichment tables
(e.g., from clusterProfiler) are saved with a lenient p-value cutoff (1.0),
allowing inspection of all terms. Plots will still use \code{pval_cutoff}.
If FALSE, tables are also filtered by \code{pval_cutoff}. Default: TRUE.}

\item{plot_width}{A numeric value for the width of individual saved plots.
Default: 8.}

\item{plot_height}{A numeric value for the height of individual saved plots.
Default: 6.}

\item{plot_units}{A string specifying the units for \code{plot_width} and
\code{plot_height} (e.g., "in", "cm", "mm"). Default: "in".}

\item{plot_dpi}{A numeric value for the resolution (DPI) of individual saved plots.
Default: 300.}

\item{plot_formats}{A character vector of formats for saving individual plots
(e.g., "png", "pdf", "svg"). Default: c("png").}

\item{pdf_width}{A numeric value for the width of summary multi-page PDF plots.
Default: 11.}

\item{pdf_height}{A numeric value for the height of summary multi-page PDF plots.
Default: 8.5.}

\item{cnet_color_edge}{A logical value. If TRUE, edges in cnetplots will be
colored based on fold change. Default: TRUE.}

\item{parallel.per.celltype}{A logical value. If TRUE, processing for each
cell type in \code{de_results_list} will be attempted in parallel using the
\code{future} framework. Default: FALSE.}

\item{n_cores}{An optional integer specifying the number of cores to use for
parallel processing. If NULL, \code{future::availableCores() - 1} will be used.
Only relevant if \code{parallel.per.celltype} is TRUE. Default: NULL.}
}
\value{
Invisibly returns a list named by cell types, where each element
contains sub-lists for "UpRegulated_CP_results" and "DownRegulated_CP_results"
(the results from \code{run_clusterprofiler_and_pathview}).
}
\description{
This function conducts a series of enrichment analyses (Enrichr, GO, KEGG, Reactome)
for up- and down-regulated genes from differential expression results for multiple
cell types. It also integrates Pathview for KEGG pathway visualization and
generates various plots (barplots, cnetplots).
}
\examples{
\dontrun{
# Create dummy DE results list
set.seed(123)
gene_names <- paste0("Gene", 1:1000)
de_data1 <- data.frame(
  gene = sample(gene_names, 500),
  avg_log2FC = rnorm(500, 0, 1.5),
  p_val_adj = runif(500, 0, 0.2)
)
de_data1$avg_log2FC[1:20] <- rnorm(20, 2, 0.5); de_data1$p_val_adj[1:20] <- runif(20, 0, 0.04)
de_data1$avg_log2FC[21:40] <- rnorm(20, -2, 0.5); de_data1$p_val_adj[21:40] <- runif(20, 0, 0.04)

de_data2 <- data.frame(
  gene = sample(gene_names, 600),
  avg_log2FC = rnorm(600, 0, 1),
  p_val_adj = runif(600, 0, 0.3)
)
de_data2$avg_log2FC[1:15] <- rnorm(15, 1.8, 0.4); de_data2$p_val_adj[1:15] <- runif(15, 0, 0.03)
de_data2$avg_log2FC[16:35] <- rnorm(20, -1.5, 0.6); de_data2$p_val_adj[16:35] <- runif(20, 0, 0.045)

my_de_list <- list(Epithelial_Type1 = de_data1, Stromal_TypeA = de_data2)

# Run the analysis
results <- perform_enrichment_dual_pathview_refactored(
  de_results_list = my_de_list,
  outdir = "my_enrichment_output_roxygen_example",
  pval_cutoff = 0.05,
  up_log2fc_threshold = 0.5,
  down_log2fc_threshold = -0.5,
  max_genes_for_enrichment = 150, # Analyze top 150 up/down
  kegg_n = 5,
  plot_formats = c("png", "pdf"),
  parallel.per.celltype = TRUE,
  n_cores = 2
)

# To use all significant genes (default behavior for max_genes_for_enrichment):
results_all_sig <- perform_enrichment_dual_pathview_refactored(
  de_results_list = my_de_list,
  outdir = "my_enrichment_output_roxygen_all_sig",
  max_genes_for_enrichment = NULL # or Inf, or omit the parameter
)
}

}
