% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/plot_specific_celltype_heatmap.R
\name{plotSpecificCellTypeHeatmap}
\alias{plotSpecificCellTypeHeatmap}
\title{Generate a Focused Pseudobulk Heatmap for Specific Cell Types}
\usage{
plotSpecificCellTypeHeatmap(
  seurat_obj,
  target_celltypes,
  genes_for_heatmap,
  celltype_column,
  disease_column,
  subject_column = "orig.ident",
  assay = "RNA",
  min.cells.per.subject = 3,
  Cell_Colors = NULL,
  disease_colors = NULL,
  subject_colors = NULL,
  normalization_method = "zscore",
  zscore_colors = circlize::colorRamp2(c(-1, 0, 1), c("blue", "white", "red")),
  order_rows_by_condition = FALSE,
  condition1_for_ordering = NULL,
  condition2_for_ordering = NULL,
  row_names_fontsize = 8,
  pdf_filename = "specific_celltype_heatmap.pdf",
  png_filename = "specific_celltype_heatmap.png",
  cores = 1,
  verbose = TRUE
)
}
\arguments{
\item{seurat_obj}{A Seurat object containing single-cell RNA sequencing data.}

\item{target_celltypes}{A character vector specifying the cell type(s) of interest
to include in the heatmap. These must match values in the \code{celltype_column}.}

\item{genes_for_heatmap}{A character vector of gene names to be plotted.}

\item{celltype_column}{A string indicating the metadata column name in
\code{seurat_obj@meta.data} that contains cell type annotations.}

\item{disease_column}{A string indicating the metadata column name for disease
status or other primary condition for comparison.}

\item{subject_column}{A string, the metadata column name for subject or sample
identifiers. Default is "orig.ident".}

\item{assay}{A string, the Seurat assay to use for gene expression data (e.g.,
"RNA", "SCT"). Default is "RNA".}

\item{min.cells.per.subject}{An integer, the minimum number of cells required for a
given cell type, disease, and subject combination to be included in
pseudobulk calculation. Default is 3. (Set to 0 to include all regardless of cell count).}

\item{Cell_Colors}{A named list or vector providing colors for cell types. Names
should match cell type names. If \code{NULL} or incomplete, colors are
auto-generated. Default is \code{NULL}.}

\item{disease_colors}{A named list or vector for disease status colors. Names
should match disease status labels. If \code{NULL} or incomplete, colors are
auto-generated. Default is \code{NULL}.}

\item{subject_colors}{A named list or vector for subject colors. Shown in
annotation if few subjects and colors provided/generated. Default is \code{NULL}.}

\item{normalization_method}{A string, either "zscore" (calculates Z-score per
gene across samples) or "unity" (scales expression 0-1 per gene).
Default is "zscore".}

\item{zscore_colors}{A \code{circlize::colorRamp2} function or a vector of colors
used for the heatmap when \code{normalization_method} is "zscore".
Default is \code{circlize::colorRamp2(c(-2, 0, 2), c("blue", "white", "red"))}.}

\item{order_rows_by_condition}{A logical. If TRUE and \code{normalization_method} is "zscore",
rows (genes) will be ordered based on their differential expression pattern
(e.g., high in \code{condition1_for_ordering}, low in \code{condition2_for_ordering}).
Hierarchical clustering of rows is disabled if this is TRUE. Default is \code{FALSE}.}

\item{condition1_for_ordering}{A string. If \code{order_rows_by_condition} is TRUE, this is
the name of the primary condition (from \code{disease_column}) whose high expression
should be prioritized at the top of the heatmap (e.g., "PAH").
Required if \code{order_rows_by_condition} is TRUE. Default is \code{NULL}.}

\item{condition2_for_ordering}{A string. If \code{order_rows_by_condition} is TRUE, this is
the name of the secondary/control condition (from \code{disease_column}) whose low expression,
in conjunction with high expression in \code{condition1_for_ordering},
should be prioritized. Required if \code{order_rows_by_condition} is TRUE. Default is \code{NULL}.}

\item{row_names_fontsize}{A numeric value specifying the font size for row names
(gene names) in the heatmap. Default is 8.}

\item{pdf_filename}{A string, the filename for saving the heatmap as a PDF.
Set to \code{NULL} to disable PDF saving. Default is "specific_celltype_heatmap.pdf".}

\item{png_filename}{A string, the filename for saving the heatmap as a PNG.
Set to \code{NULL} to disable PNG saving. Default is "specific_celltype_heatmap.png".}

\item{cores}{An integer, the number of cores to use for parallel processing.
Uses \code{lapply} if \code{cores = 1} or on Windows. Default is 1.}

\item{verbose}{A logical, whether to print progress messages. Default is \code{TRUE}.}
}
\value{
Invisibly returns a \code{Heatmap} object generated by \code{ComplexHeatmap::Heatmap()}.
This object can be drawn manually or further modified.
}
\description{
This function creates a heatmap of average gene expression for specified
target cell types from a Seurat object. It calculates pseudobulk profiles
per subject and disease condition within the target cell types, normalizes
the expression, and plots a heatmap using ComplexHeatmap.
Compatible with Seurat v4 and v5 object structures (including layers).
Rows can be ordered to highlight genes upregulated in one condition (e.g., "PAH")
and downregulated in another (e.g., "CTRL").
}
\details{
The function performs several steps including input validation, gene filtering,
pseudobulk calculation, and normalization.
If \code{order_rows_by_condition} is TRUE (and using z-score normalization),
genes are sorted to highlight differences between \code{condition1_for_ordering}
and \code{condition2_for_ordering}. Specifically, it calculates \code{mean_Zscore(condition1) - mean_Zscore(condition2)}
for each gene and sorts genes by this difference in descending order.
}
\examples{
\dontrun{
# Assuming 'pbmc_small' is a Seurat object
# Add example metadata
pbmc_small$cell_type_annotations <- sample(c("CD4 T", "B cell", "Monocyte"), ncol(pbmc_small), replace = TRUE)
pbmc_small$disease_status <- sample(c("ConditionA", "ConditionB"), ncol(pbmc_small), replace = TRUE)
pbmc_small$patient_id <- pbmc_small$orig.ident
example_genes <- rownames(pbmc_small)[1:20]

# Heatmap with custom row ordering and larger row names
custom_ordered_heatmap <- plotSpecificCellTypeHeatmap(
  seurat_obj = pbmc_small,
  target_celltypes = "CD4 T",
  genes_for_heatmap = example_genes,
  celltype_column = "cell_type_annotations",
  disease_column = "disease_status",
  subject_column = "patient_id",
  normalization_method = "zscore",
  order_rows_by_condition = TRUE,
  condition1_for_ordering = "ConditionA", # e.g., "PAH"
  condition2_for_ordering = "ConditionB", # e.g., "CTRL"
  row_names_fontsize = 10, # Custom font size for gene names
  min.cells.per.subject = 0,
  pdf_filename = NULL,
  png_filename = "cd4_custom_order_heatmap.png"
)
# ComplexHeatmap::draw(custom_ordered_heatmap)
}

}
