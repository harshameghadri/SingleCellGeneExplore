% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/plot_cell_frequency_boxplots.R
\name{plot_cell_frequency_boxplots}
\alias{plot_cell_frequency_boxplots}
\title{Create Boxplots with Significance Stars for Cell Type Frequencies}
\usage{
plot_cell_frequency_boxplots(
  seurat_obj,
  cell_type_column,
  condition_column,
  sample_column,
  output_prefix,
  output_dir = ".",
  width = 10,
  height = 6,
  dpi = 300,
  control_level = "CTRL",
  disease_level = "PAH",
  control_color = "dodgerblue2",
  disease_color = "firebrick",
  star_height = 95,
  y_max_limit = NULL,
  paired = FALSE,
  x_angle = 45,
  plot_title = "Cell Type Frequencies by Condition",
  save_results = TRUE,
  sort_alphabetically = FALSE,
  custom_x_axis_order = NULL
)
}
\arguments{
\item{seurat_obj}{A Seurat object containing the single-cell data.}

\item{cell_type_column}{Character string specifying the column in meta.data containing cell types.}

\item{condition_column}{Character string specifying the column in meta.data containing disease/control status.}

\item{sample_column}{Character string specifying the column in meta.data containing sample IDs. Used for pairing if \code{paired = TRUE}.}

\item{output_prefix}{Character string for the output file names (without extension).}

\item{output_dir}{Character string specifying directory to save output files (default: current directory).}

\item{width}{Numeric value specifying figure width in inches (default: 10).}

\item{height}{Numeric value specifying figure height in inches (default: 6).}

\item{dpi}{Numeric value specifying resolution for PNG output (default: 300).}

\item{control_level}{Character string specifying the control level in condition_column (default: "CTRL").}

\item{disease_level}{Character string specifying the disease level in condition_column (default: "PAH").}

\item{control_color}{Character string specifying color for control (default: "dodgerblue2").}

\item{disease_color}{Character string specifying color for disease (default: "firebrick").}

\item{star_height}{Numeric value specifying the absolute y-coordinate for placing significance stars (default: 95).
Ensure this value is appropriate for the y-axis scale, especially when \code{y_max_limit} is set.}

\item{y_max_limit}{Optional numeric value specifying the maximum limit for the y-axis.
If NULL (default), the y-axis limit is determined dynamically based on data and \code{star_height}.
If set, \code{star_height} should ideally be less than \code{y_max_limit}.}

\item{paired}{Logical indicating whether samples should be treated as paired (default: FALSE). Requires samples to be present in both conditions.}

\item{x_angle}{Numeric value specifying the angle of x-axis labels (default: 45).}

\item{plot_title}{Character string specifying the plot title (default: "Cell Type Frequencies by Condition").}

\item{save_results}{Logical indicating whether to save the significance results to a file (default: TRUE).}

\item{sort_alphabetically}{Logical or character string defining the sorting order of cell types on the
x-axis if \code{custom_x_axis_order} is \code{NULL}.
Accepted values:
\itemize{
\item \code{TRUE}: Sorts cell types alphabetically (A-Z).
\item \code{FALSE} (default): Also sorts cell types alphabetically (A-Z), maintaining consistency with previous default behavior.
\item \code{"INVERSE"}: Sorts cell types in reverse alphabetical order (Z-A).
}
If an invalid value is provided, a warning is issued, and it defaults to \code{FALSE} (A-Z sorting).}

\item{custom_x_axis_order}{Optional character vector. If provided, it dictates the specific order of
cell types on the x-axis, overriding \code{sort_alphabetically}.
Cell types from the data that are included in this vector will be ordered as specified.
Cell types present in the data but NOT in \code{custom_x_axis_order} will be appended to the end,
sorted alphabetically (A-Z).
Cell types specified in \code{custom_x_axis_order} but NOT present in the data will be ignored,
and a warning will be issued. (Default: \code{NULL}).}
}
\value{
A ggplot object of the boxplot with significance stars.
}
\description{
This function generates boxplots showing the frequency distribution of cell types between
conditions (e.g., disease vs control), with significance stars indicating statistical
differences based on Wilcoxon rank-sum tests (unpaired) or Wilcoxon signed-rank tests (paired).
Relies on \code{wilcox.test} internal handling for small sample sizes.
}
\details{
This function calculates the frequency of each cell type within each sample.
It then performs Wilcoxon tests (unpaired rank-sum or paired signed-rank)
to compare conditions for each cell type (provided the type exists in both conditions)
and adds significance stars (* p<0.05, ** p<0.01, *** p<0.001)
or "ns" (not significant) to the plot. It saves the plot as both PDF and PNG files,
and optionally saves the test results. For paired tests, only samples present under
both conditions are included in the test for a given cell type.
The order of cell types on the x-axis can be controlled using \code{sort_alphabetically}
or \code{custom_x_axis_order}.
Note: This version removed explicit minimum sample size checks before running Wilcoxon tests,
relying on \code{stats::wilcox.test}'s internal handling.
}
\examples{
\dontrun{
# Assuming PAH.obj.Int.Stromal.4.clean is a Seurat object
# and necessary packages (dplyr, ggplot2, rlang, tidyr if paired) are installed.

# Example with default y-axis scaling and default A-Z sorting
plot_cell_frequency_boxplots(
  seurat_obj = PAH.obj.Int.Stromal.4.clean,
  cell_type_column = "stromal.cell.type.final",
  condition_column = "disease.ident",
  sample_column = "orig.ident",
  output_prefix = "Stromal_Cell_Frequencies_DefaultSort",
  output_dir = "./results",
  control_level = "Control",
  disease_level = "Disease",
  paired = FALSE
)

# Example with reverse alphabetical sorting (Z-A)
plot_cell_frequency_boxplots(
  seurat_obj = PAH.obj.Int.Stromal.4.clean,
  cell_type_column = "stromal.cell.type.final",
  condition_column = "disease.ident",
  sample_column = "orig.ident",
  output_prefix = "Stromal_Cell_Frequencies_ReverseSort",
  output_dir = "./results",
  control_level = "Control",
  disease_level = "Disease",
  sort_alphabetically = "INVERSE",
  paired = FALSE
)

# Example with a custom x-axis order
custom_order <- c("Adventitial Fibroblast", "Pericyte", "Smooth Muscle Cell") # Example types
plot_cell_frequency_boxplots(
  seurat_obj = PAH.obj.Int.Stromal.4.clean,
  cell_type_column = "stromal.cell.type.final",
  condition_column = "disease.ident",
  sample_column = "orig.ident",
  output_prefix = "Stromal_Cell_Frequencies_CustomOrder",
  output_dir = "./results",
  control_level = "Control",
  disease_level = "Disease",
  custom_x_axis_order = custom_order,
  paired = FALSE
)

# Example with a custom y-axis maximum limit of 50\%
# Note: You might need to adjust star_height if setting y_max_limit.
# For y_max_limit = 50, a star_height of e.g., 47 might be appropriate.
plot_cell_frequency_boxplots(
  seurat_obj = PAH.obj.Int.Stromal.4.clean,
  cell_type_column = "stromal.cell.type.final",
  condition_column = "disease.ident",
  sample_column = "orig.ident",
  output_prefix = "Stromal_Cell_Frequencies_CustomYlim",
  output_dir = "./results",
  control_level = "Control",
  disease_level = "Disease",
  y_max_limit = 50,
  star_height = 47, # Adjusted star_height for the new y_max_limit
  paired = FALSE
)
}

}
